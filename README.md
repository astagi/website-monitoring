# Website monitoring

This sample project monitors a list of websites, storing log time,
time of the request, its status code, the result of the regex on the content
(if any)

## Structure

The application runs with Docker and is made of two parts:

- `producer`: the producer is responsible to get collect website metrics,
  executing regex searches (if a regex is defined in `producer/config.json`),
  then sends metrics to a specific Kafka topic (`reports`).
- `consumer`: the consumer is responsible to get website metrics generated by
  `producer` from the Kafka topic (`reports`) and store them into a PostgreSQL database.

## Run application locally

### Setup .env file

This file contains the environment variables for the application. To start with a sample file

```bash
cp example.env .env
```

### Setup config.json file

This file contains rules for monitoring websites. To start with a sample file

```bash
cp example.config.json producer/config.json
```

Then edit `producer/config.json` file to define rules.

### Start local docker

```bash
docker-compose up
```

## Development

### Install dev requirements

Activate your virtual environment, then run

```bash
pip install -r requirements-dev.txt
```

### Run tests

Activate your virtual environment, then run

```bash
make test
```

### Run integration tests

Activate your virtual environment, then run

```bash
make integration-test
```

## Utils

### Clean Kafka topics

If you need you can clean Kafka topics inside the container running during development

```bash
kafka-topics.sh --zookeeper zookeeper:2181 --alter --topic report --config retention.ms=1000
```
